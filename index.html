<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Souvenir Shop - Mùa Yêu Thương</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="sakura-container"></div>
    <canvas id="constellation"></canvas>

    <header class="main-header" id="header-bar">
        <div class="search-box">
            <input type="text" id="order-search-input" placeholder="Nhập mã đơn (8 số)" maxlength="8">
            <button onclick="checkOrder()"><i class="fas fa-search"></i> Tra cứu</button>
        </div>
    </header>

    <button id="back-home-btn" class="hidden" onclick="goHome()"><i class="fas fa-heart"></i> Trang chủ</button>

    <main id="home-page">
        <section class="hero-section curved-bg">
            <img src="https://images.unsplash.com/photo-1518199266791-5375a83190b7?w=1200" alt="Shop Banner" class="hero-img">
            <h1 class="shop-name floating-text">Tiệm Lưu Niệm Bốn Mùa</h1>
        </section>

        <section class="seasons-nav">
            <div class="season-card spring-card" onclick="showPasswordModal('spring')">
                <img src="https://images.unsplash.com/photo-1490750967868-88aa4486c946?w=400" alt="Xuân">
                <span class="season-text">Xuân Thì</span>
                <div class="secret-hint"><i class="fas fa-lock"></i> Bí mật</div>
            </div>
            <div class="season-card summer-card" onclick="showPasswordModal('summer')">
                <img src="https://images.unsplash.com/photo-1504194921103-98a190533f81?w=400" alt="Hạ">
                <span class="season-text">Hạ Nồng</span>
                <div class="secret-hint"><i class="fas fa-lock"></i> Bí mật</div>
            </div>
            <div class="season-card autumn-card" onclick="showPasswordModal('autumn')">
                <img src="https://images.unsplash.com/photo-1509565840034-3c385bbe6451?w=400" alt="Thu">
                <span class="season-text">Thu Phai</span>
                <div class="secret-hint"><i class="fas fa-lock"></i> Bí mật</div>
            </div>
            <div class="season-card winter-card" onclick="showPasswordModal('winter')">
                <img src="https://images.unsplash.com/photo-1483664852095-d6cc687070ef?w=400" alt="Đông">
                <span class="season-text">Đông Lạnh</span>
                <div class="secret-hint"><i class="fas fa-lock"></i> Bí mật</div>
            </div>
        </section>

        <section class="products-section">
            <h2 class="fancy-title">Bộ Sưu Tập Ký Ức</h2>
            <div class="product-grid" id="product-list"></div>
        </section>

        <section class="vietnam-seasons-info">
            <h2 class="fancy-title">Hương Sắc Việt Nam</h2>
            
            <div class="vn-season-row" id="vn-spring">
                <div class="vn-content">
                    <h3>Mùa Xuân</h3>
                    <p>Đào phai khoe sắc, mưa phùn bay lất phất trên phố cổ Hà Nội. Mùa của sự khởi đầu mới mẻ.</p>
                </div>
                <div class="vn-images">
                    <img src="https://images.unsplash.com/photo-1550596334-7bb40a71b6bc?w=500" class="img-style-1">
                    <img src="https://images.unsplash.com/photo-1582450871972-ab5ca641643d?w=500" class="img-style-2">
                </div>
            </div>

            <div class="vn-season-row reverse" id="vn-summer">
                <div class="vn-images">
                    <img src="https://images.unsplash.com/photo-1504194921103-98a190533f81?w=500" class="img-style-1">
                    <img src="https://images.unsplash.com/photo-1559592413-7cec4d0ea49b?w=500" class="img-style-2">
                </div>
                <div class="vn-content">
                    <h3>Mùa Hạ</h3>
                    <p>Phượng vĩ đỏ rực góc trờii, tiếng ve ngân vang gọi hè về. Biển xanh vẫy gọi.</p>
                </div>
            </div>

            <div class="vn-season-row" id="vn-autumn">
                <div class="vn-content">
                    <h3>Mùa Thu</h3>
                    <p>Hương cốm mới, lá vàng rơi xào xạc, mùa thu đẹp như một bản tình ca lãng mạn.</p>
                </div>
                <div class="vn-images">
                    <img src="https://images.unsplash.com/photo-1509565840034-3c385bbe6451?w=500" class="img-style-1">
                    <img src="https://images.unsplash.com/photo-1477414348463-c0eb7f1359b6?w=500" class="img-style-2">
                </div>
            </div>

            <div class="vn-season-row reverse" id="vn-winter">
                <div class="vn-images">
                    <img src="https://images.unsplash.com/photo-1483664852095-d6cc687070ef?w=500" class="img-style-1">
                    <img src="https://images.unsplash.com/photo-1516714819001-8ee7a13b71d7?w=500" class="img-style-2">
                </div>
                <div class="vn-content">
                    <h3>Mùa Đông</h3>
                    <p>Gió mùa đông bắc, bếp lửa hồng sưởi ấm những bàn tay lạnh. Sự tĩnh lặng đầy chất thơ.</p>
                </div>
            </div>
        </section>

        <footer class="site-footer">
            <p>© 2026 Mùa Yêu Thương. All rights reserved.</p>
            <div class="admin-access-box" onclick="showAdminLogin()">
                <i class="fas fa-crown"></i> Khu Vực Quản Lý
            </div>
        </footer>
    </main>

    <!-- Product Modal -->
    <div id="product-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">×</span>
            <div class="modal-body">
                <div class="media-section-wrapper" style="flex: 1.5;">
                    <div class="media-section">
                        <div class="slider-container">
                            <div class="slider-track" id="slider-track"></div>
                            <button class="slider-btn prev-btn" onclick="moveSlide(-1)">&#10094;</button>
                            <button class="slider-btn next-btn" onclick="moveSlide(1)">&#10095;</button>
                        </div>
                    </div>
                    <div class="season-selectors">
                        <button class="season-btn" onclick="changeProductVersion('xuan')">Xuân</button>
                        <button class="season-btn" onclick="changeProductVersion('ha')">Hạ</button>
                        <button class="season-btn" onclick="changeProductVersion('thu')">Thu</button>
                        <button class="season-btn" onclick="changeProductVersion('dong')">Đông</button>
                    </div>
                </div>

                <div class="info-section">
                    <h2 id="modal-title" class="fancy-title" style="font-size: 2.5rem;">Tên Sản Phẩm</h2>
                    <hr style="border: 0; border-top: 1px dashed var(--dark-pink); margin: 10px 0;">
                    <p><strong><i class="fas fa-layer-group"></i> Chất liệu:</strong> <span id="modal-material"></span></p>
                    <p><strong><i class="fas fa-tools"></i> Cách làm:</strong> <span id="modal-method"></span></p>
                    <p><strong><i class="fas fa-star"></i> Ý nghĩa:</strong> <span id="modal-meaning"></span></p>
                    
                    <div style="margin-top: auto;">
                        <p style="font-size: 0.9rem; font-style: italic; margin-bottom: 10px;">Liên hệ đặt hàng ngay:</p>
                        <div class="contact-btns">
                            <a href="https://zalo.me" target="_blank" class="btn-zalo"><i class="fas fa-comment-dots"></i> Zalo</a>
                            <a href="https://facebook.com" target="_blank" class="btn-fb"><i class="fab fa-facebook-messenger"></i> Messenger</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Modal for Secret Pages -->
    <div id="password-modal" class="modal hidden">
        <div class="password-box fancy-box">
            <h2 class="fancy-title"><i class="fas fa-lock"></i> Nhập Mật Khẩu Bí Mật</h2>
            <p id="password-hint" style="margin-bottom: 15px; color: #666;"></p>
            <input type="password" id="secret-password-input" placeholder="Nhập mật khẩu...">
            <button onclick="verifyPassword()" class="btn-verify-pass"><i class="fas fa-unlock"></i> Mở Khóa</button>
            <button class="btn-close-login" onclick="closePasswordModal()">Đóng</button>
            <input type="hidden" id="target-season">
        </div>
    </div>

    <!-- Thank You Page -->
    <section id="thank-you-page" class="hidden page-section">
        <div class="thank-you-container">
            <h1 id="ty-title" class="fancy-title"></h1>
            <div id="ty-content" class="ty-message"></div>
            <div class="secret-message-display" id="secret-message-box" style="display: none;">
                <h3><i class="fas fa-envelope-open-text"></i> Lờii Nhắn Bí Mật</h3>
                <p id="secret-message-content"></p>
            </div>
            <h3>Sản phẩm bạn đã chọn</h3>
            <div id="ty-products" class="ty-product-list"></div>
            <div class="spotify-embed" id="ty-spotify"></div>
        </div>
    </section>

    <!-- Admin Login -->
    <div id="admin-login" class="modal hidden">
        <div class="login-box fancy-box">
            <h2 class="fancy-title">Cổng Quản Trị</h2>
            <input type="password" id="admin-pass" placeholder="Mật khẩu bí mật...">
            <button onclick="loginAdmin()">Mở Cánh Cửa</button>
            <button class="btn-close-login" onclick="closeLogin()">Đóng</button>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <section id="admin-dashboard" class="hidden page-section">
        <h1 class="fancy-title">Quản Lý Đơn Hàng</h1>
        
        <div class="admin-panel">
            <div class="admin-form fancy-box">
                <h3><i class="fas fa-edit"></i> Tạo / Sửa Đơn</h3>
                
                <div class="input-group">
                    <label>Mã Đơn Hàng (8 số)</label>
                    <div class="row-input">
                        <input type="text" id="adm-order-id" readonly placeholder="Bấm nút tạo mã ->">
                        <button onclick="generateRandomOrderId()" class="btn-generate"><i class="fas fa-random"></i> Tạo Mã</button>
                    </div>
                </div>

                <div class="input-group">
                    <label>Tiêu đề lờii chúc</label>
                    <input type="text" id="adm-title" placeholder="VD: Gửi ngườii thương...">
                </div>

                <div class="input-group">
                    <label>Nội dung lờii chúc</label>
                    <textarea id="adm-content" rows="3" placeholder="Viết những lờii có cánh..."></textarea>
                </div>

                <div class="input-group">
                    <label>Lờii nhắn bí mật (chỉ ngườii nhận đơn hàng xem được)</label>
                    <textarea id="adm-secret-message" rows="3" placeholder="Lờii nhắn bí mật..."></textarea>
                </div>

                <div class="input-group">
                    <label>Link nhạc Spotify (Embed)</label>
                    <input type="text" id="adm-spotify" placeholder="Link embed spotify...">
                </div>

                <div class="input-group">
                    <label>Thêm sản phẩm vào đơn</label>
                    <div class="row-input">
                        <select id="adm-product-select"></select>
                        <button onclick="addProductToSelection()" class="btn-add-prod"><i class="fas fa-plus"></i> Thêm</button>
                    </div>
                </div>

                <div class="selected-products-container">
                    <label>Sản phẩm đã chọn (Bấm X để xóa):</label>
                    <div id="selected-products-list" class="tags-input">
                        <span class="empty-msg">Chưa có sản phẩm nào</span>
                    </div>
                </div>

                <!-- Connection Status -->
                <div class="input-group">
                    <label><i class="fas fa-shield-alt"></i> Trạng Thái Kết Nối</label>
                    <div class="connection-status">
                        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                            <div class="status-item">
                                <i class="fas fa-database"></i> Supabase: 
                                <span id="supabase-status" class="badge">Checking...</span>
                            </div>
                            <div class="status-item">
                                <i class="fas fa-robot"></i> Groq API: 
                                <span id="groq-status" class="badge">Checking...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API Configuration -->
                <div class="input-group">
                    <label><i class="fas fa-key"></i> Cấu Hình Groq API Key</label>
                    <div class="api-config-box">
                        <div id="api-status-display" style="margin-bottom: 10px; color: #e74c3c;">
                            <i class="fas fa-times-circle"></i> Chưa cấu hình
                        </div>
                        <div class="row-input">
                            <input type="password" id="groq-api-key" placeholder="gsk_..." style="flex: 1;">
                            <button onclick="saveApiKey()" class="btn-save-api">
                                <i class="fas fa-save"></i> Lưu
                            </button>
                            <button onclick="testApiConnection()" class="btn-test-api">
                                <i class="fas fa-vial"></i> Test
                            </button>
                        </div>
                        <small style="color: #666; display: block; margin-top: 8px;">
                            <i class="fas fa-info-circle"></i> Key được lưu vào Supabase Settings. Trên Vercel, key cũng cần được thêm vào Environment Variables.
                        </small>
                    </div>
                </div>

                <div class="input-group">
                    <label><i class="fas fa-key"></i> Mật Khẩu Bí Mật Theo Mùa</label>
                    <button onclick="generateSeasonPasswords()" class="btn-generate" style="width: 100%; margin-bottom: 10px;">
                        <i class="fas fa-magic"></i> Tạo 4 Mật Khẩu Cho Các Mùa
                    </button>
                    
                    <div class="season-passwords-grid" id="season-passwords-container">
                        <div class="season-pass-box">
                            <h4><i class="fas fa-seedling" style="color: #10b981;"></i> Xuân</h4>
                            <input type="text" id="pass-spring" readonly placeholder="Chưa tạo">
                            <div id="qr-spring" class="qr-code"></div>
                        </div>
                        <div class="season-pass-box">
                            <h4><i class="fas fa-sun" style="color: #f59e0b;"></i> Hạ</h4>
                            <input type="text" id="pass-summer" readonly placeholder="Chưa tạo">
                            <div id="qr-summer" class="qr-code"></div>
                        </div>
                        <div class="season-pass-box">
                            <h4><i class="fas fa-leaf" style="color: #d35400;"></i> Thu</h4>
                            <input type="text" id="pass-autumn" readonly placeholder="Chưa tạo">
                            <div id="qr-autumn" class="qr-code"></div>
                        </div>
                        <div class="season-pass-box">
                            <h4><i class="fas fa-snowflake" style="color: #0984e3;"></i> Đông</h4>
                            <input type="text" id="pass-winter" readonly placeholder="Chưa tạo">
                            <div id="qr-winter" class="qr-code"></div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn-save" onclick="saveOrder()"><i class="fas fa-save"></i> Lưu Đơn Hàng</button>
                    <button class="btn-clear" onclick="clearForm()"><i class="fas fa-eraser"></i> Làm Mới</button>
                </div>
            </div>

            <div class="admin-list fancy-box">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3><i class="fas fa-list"></i> Danh Sách Đơn (Từ Supabase)</h3>
                    <button onclick="window.print()" class="btn-print no-print"><i class="fas fa-print"></i> In Danh Sách</button>
                </div>
                
                <div class="table-responsive">
                    <table id="order-table">
                        <thead>
                            <tr>
                                <th>Mã Đơn</th>
                                <th>Tiêu đề</th>
                                <th>Mật khẩu các mùa & QR</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <script src="js/config.js"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/script.js"></script>
</body>
</html>